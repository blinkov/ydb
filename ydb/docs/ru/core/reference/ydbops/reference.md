# Справочник по ydbops

## Опции ydbops

### Опции подключения к БД

Опции подключения к БД описаны в разделе [Подключение и аутентификация в базе данных](../ydb-cli/connect.md#command-line-pars).

### Опции сервиса

- `--verbose`: увеличивает подробность вывода.
- `--profile-file`: использовать профили из указанного файла. По умолчанию используются профили из файла `$HOME/ydb/ydbops/config/config.yaml`.
- `--profile <string>`: переопределить текущее имя профиля из `--profile-file`.

- `--grpc-timeout-seconds <int>`: время ожидания в секундах до таймаута любых GRPC-запросов (по умолчанию 60).
- `--grpc-skip-verify`: не проверять имя хоста сервера при использовании gRPCs.
- `--ca-file <filepath>`: путь к корневому CA-файлу, добавляется к системному пулу.

## Опции перезапуска ydbops

- `--storage`: включать только storage-узлы. Если не указаны ни `--storage`, ни `--tenant`, активируются оба параметра, так как предполагается, что намерение состоит в перезапуске всего кластера.
- `--tenant`: включать только tenant-узлы. Дополнительно можно указать:

  - `--tenant-list=<tenant-name-1>,<tenant-name-2>`

- `--availability-mode <strong|weak|force>`: см. [статью об обслуживании без простоя](../../devops/manual/maintenance-without-downtime). По умолчанию `strong`.
- `--restart-duration <int>`: умноженное на `--restart-retry-number`, это даёт общую продолжительность операции обслуживания в секундах. Другими словами, это обещание CMS, что перезапуск одного узла завершится в течение указанного времени. По умолчанию 60 (что делает продолжительность запроса CMS по умолчанию 180 секунд в сочетании со значением по умолчанию `--restart-retry-number`)
- `--restart-retry-number <int>`: если перезапуск конкретного узла не удался, повторить операцию перезапуска указанное количество раз. По умолчанию 3.
- `--cms-query-interval <int>`: как часто запрашивать обновления от CMS при ожидании новых узлов. По умолчанию 10 секунд.

### Опции фильтрации

Опции фильтрации позволяют сузить список узлов для перезапуска.

- `--hosts <list>`: перезапустить следующие хосты. Хосты можно указать несколькими способами:
  - Используя идентификаторы узлов: `--hosts=1,2,3`
  - Используя FQDN хостов: `--hosts=<node1.some.zone>,<node2.some.zone>`
- `--exclude-hosts <list>`: не перезапускать следующие хосты, даже если они явно включены. Синтаксис такой же, как и с опцией `--hosts`.
- `--started '<sign><timestamp>'`: перезапустить только узлы, которые удовлетворяют определённому времени работы. Укажите знак (`<` или `>`) и временную метку в формате ISO, чтобы отфильтровать только узлы, которые запустились до или после определённой временной метки. Будьте осторожны и заключайте временную метку со знаком в кавычки, иначе shell может интерпретировать знак как перенаправление потока.
  - пример: `ydbops restart --started '>2024-03-13T17:00:00Z'`
- `--version '<sign><major>.<minor>.<patch>'`: перезапустить только узлы, которые удовлетворяют определённому фильтру версии. Укажите знак (`<`, `>`, `!=` или `==`), затем укажите версию, предоставив три числа: основную, минорную и патч-версии. Будьте осторожны и заключайте версию со знаком в кавычки, иначе shell может интерпретировать знак как перенаправление потока.
  - пример: `ydbops restart --version '>24.3.1'`
  - команда работает с процессами ydb, у которых версия имеет следующий формат: `ydb-stable-<major>-<minor>-<patch>.*`. Хотфикс-версии (например, `ydb-stable-24-1-14-hotfix-9`) имеют те же основные, минорные и патч-номера, что и соответствую��ая не-хотфикс версия `24.1.14`. Например, версия `ydb-stable-24-1-14-hotfix-9` в операциях сравнения будет идентична версии `ydb-stable-24-1-14`.

### Опции Kubernetes

Если указан `--kubeconfig`, предполагается, что кластер, который нужно перезапустить, работает под управлением Kubernetes, и перезапуск узлов будет осуществляться путём удаления подов, а не другими способами перезапуска (например, systemd units).

- `--kubeconfig`: расположение файла kubeconfig, который будет использоваться для взаимодействия с API Kubernetes (например, для перезапуска узлов путём удаления подов). Значение по умолчанию отсутствует, так как указание этой опции также указывает на режим Kubernetes.
- `--k8s-namespace`: пространство имён, где расположены поды с процессами storage или tenant. Сценарий использования с узлами, расположенными в нескольких пространствах имён, в настоящее время не поддерживается.