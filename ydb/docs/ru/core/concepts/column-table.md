# Таблицы с колоночным хранением

{% note warning %}

Таблицы с колоночным хранением в {{ ydb-short-name }} находятся в режиме Preview.

{% endnote %}

Таблица с колоночным хранением в {{ ydb-short-name }} — это реляционная таблица, содержащая набор связанных данных и состоящая из строк и столбцов. В отличие от обычных [таблиц со строчным хранением {{ ydb-short-name }}](#table), предназначенных для [OLTP-нагрузок](https://ru.wikipedia.org/wiki/OLTP), таблицы с колоночным хранением оптимизированы для аналитики данных и [OLAP-нагрузок](https://ru.wikipedia.org/wiki/OLAP).

В настоящее время основной сценарий использования таблиц с колоночным хранением — это запись данных с возрастающим первичным ключом, например, временем события, анализ этих данных и удаление устаревших данных по TTL. Оптимальный способ вставки данных в таблицы с к��лоночным хранением — пакетная запись блоками размером в несколько мегабайт.

Пакеты данных вставляются атомарно: данные будут записаны либо во все разделы, либо ни в один из них. Операции чтения анализируют только те данные, которые были полностью записаны в ваши таблицы с колоночным хранением.

В большинстве случаев работа с таблицами с колоночным хранением {{ ydb-short-name }} похожа на работу с таблицами со строчным хранением. Однако есть следующие отличия:

* В качестве ключевых столбцов можно использовать только столбцы NOT NULL.
* Данные разделяются не по первичному ключу, а по хешу от [столбцов секционирования](#olap-tables-partitioning).
* Поддерживается [ограниченный набор](#olap-data-types) типов данных.

В настоящее время не поддерживается:

* Чтение данных из реплик
* Вторичные индексы
* Фильтры Блума
* Change Data Capture
* Переименование таблиц
* Пользовательские атрибуты в таблицах
* Обновление списка столбцов данных в таблицах с колоночным хранением
* Добавление данных в таблицы с колоночным хранением с помощью SQL-оператора `INSERT`
* Удаление данных из таблиц с колоночным хранением с помощью SQL-оператора `DELETE`. Фактическое удаление данных происходит по истечении TTL.

## Поддерживаемые типы данных {#olap-data-types}

| Тип данных | Можно использовать в<br/>таблицах с колоночным хранением | Можно использовать<br/>как первичный ключ |
---|---|---
| `Bool` | ☓ | ☓ |
| `Date` | ✓ | ✓ |
| `Datetime` | ✓ | ✓ |
| `Decimal` | ☓ | ☓ |
| `Double` | ✓ | ☓ |
| `Float` | ✓ | ☓ |
| `Int16` | ✓ | ☓ |
| `Int32` | ✓ | ✓ |
| `Int64` | ✓ | ✓ |
| `Int8` | ✓ | ☓ |
| `Interval` | ☓ | ☓ |
| `JsonDocument` | ✓ | ☓ |
| `Json` | ✓ | ☓ |
| `String` | ✓ | ✓ |
| `Timestamp` | ✓ | ✓ |
| `Uint16` | ✓ | ✓ |
| `Uint32` | ✓ | ✓ |
| `Uint64` | ✓ | ✓ |
| `Uint8` | ✓ | ✓ |
| `Utf8` | ✓ | ✓ |
| `Uuid` | ☓ | ☓ |
| `Yson` | ✓ | ☓ |

Подробнее в [{#T}](../yql/reference/types/index.md).

## Секционирование {#olap-tables-partitioning}

В отличие от таблиц со строчным хранением {{ ydb-short-name }}, таблицы с колоночным хранением нельзя секционировать по первичным ключам, а только по специально назначенным ключам секционирования. Ключи секционирования представляют собой подмножество первичных ключей таблицы.

В отличие от секционирования данных в таблицах со строчным хранением {{ ydb-short-name }}, в таблицах с колоночным хранением для секционирования данных используются не значения ключей, а хеш-значения от ключей. Таким образом, данные можно равномерно распределить по всем существующим ра��делам. Такой тип секционирования позволяет избежать горячих точек при вставке данных, оптимизируя аналитические запросы, обрабатывающие (то есть читающие) большие объемы данных.

Выбор ключей секционирования существенно влияет на производительность таблиц с колоночным хранением. Подробнее в [{#T}](../best_practices/pk-olap-scalability.md).

Для управления секционированием данных используется дополнительный параметр `AUTO_PARTITIONING_MIN_PARTITIONS_COUNT`. Система игнорирует другие параметры секционирования для таблиц с колоночным хранением.

`AUTO_PARTITIONING_MIN_PARTITIONS_COUNT` задает минимальное физическое количество разделов, используемых для хранения данных.

* Тип: `Uint64`.
* Значение по умолчанию: `1`.

Поскольку система игнорирует все остальные параметры секционирования, это же зна��ение используется в качестве верхнего предела разделов.

## Смотрите также {#see-also}

* [{#T}](../yql/reference/syntax/create_table.md#olap-tables)